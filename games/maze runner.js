/*
@title: maze runner
@author: wetf
*/

const player = "p";
const wall = "w";
const finnish = "f";

setLegend(
  [ player, bitmap`
................
................
.......000......
.......0.0......
......0..0......
......0...0.0...
....0003.30.0...
....0.0...000...
....0.05550.....
......0...0.....
.....0....0.....
.....0...0......
......000.......
......0.0.......
.....00.00......
................`],
  [ wall, bitmap`
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000`],
  [ finnish, bitmap`
................
.66666666666666.
.68888888888886.
.68..........86.
.68..........86.
.68..........86.
.68..........86.
.68..........86.
.68..........86.
.68..........86.
.68..........86.
.68..........86.
.68..........86.
.68888888888886.
.66666666666666.
................`]
);

setSolids([ player, wall ]);

let level = 0;
const levels = [
  map`
pw...
.w.w.
...w.
ww.wf
ww...`,
  map`
p...wf
www.w.
www.w.
....w.
.wwww.
......`,
  map`
fww........w...
..w.wwwwww.w.w.
w.w.w....w.w.w.
w.w.w.ww.w.w.w.
..w.w.wp.w...w.
.w....wwwwwwww.
.w.wwww......w.
.w......wwww.w.
.wwwwwww....ww.
.........ww....`,
  map`
pw...w...w...wfw
.w.w.w.w.w.w.w..
.w.w.w.w.w.w.ww.
.w.w.w.w.w.w.w..
.w.w.w.w.w.w.w.w
.w.w.w.w.w.w.w..
.w.w.w.w.w.w.ww.
.w.w.w.w.w.w....
.w.w.w.w.w.wwwww
.w.w.w.w.w......
.w.w.w.w.wwwwww.
.w.w.w.w........
.w.w.w.wwwwwwwww
.w.w.w..........
.w.w.wwwwwwwwww.
...w............`,
  map`
p....................
wwwwwwwwwwwwwwwwwwww.
...................w.
.wwwwwwwwwwwwwwwww.w.
.w...............w.w.
.w.wwwwwwwwwwwww.w.w.
.w.w...........w.w.w.
.w.w.wwwwwwwww.w.w.w.
.w.w.w.......w.w.w.w.
.w.w.w.wwwww.w.w.w.w.
.w.w.w.w...w.w.w.w.w.
.w.w.w.w.w.w.w.w.w.w.
.w.w.w.wfw...w.w.w.w.
.w.w.w.wwwwwww.w.w.w.
.w.w.w.........w.w.w.
.w.w.wwwwwwwwwww.w.w.
.w.w.............w.w.
.w.wwwwwwwwwwwwwww.w.
.w.................w.
.wwwwwwwwwwwwwwwwwww.
.....................`,
  map`
...................................................
...................................................
...................................................
......w.....w......wwwwww......w.....w.............
......w.....w.....w......w.....w.....w.............
......w.....w.....w......w.....w.....w.............
......w.....w.....w......w.....w.....w.............
......w.....w.....w......w.....w.....w.............
......w.....w.....w......w.....w.....w.............
.......wwwww......w......w.....w.....w.............
.........w........w......w.....w.....w.............
.........w........w......w.....w.....w.............
.........w.........wwwwww.......wwwww..............
.........w.........................................
.........w.........................................
...................................................
.........................w.........................
.............................ww....ww..............
.............................www...ww..............
.......w...w...w.........w...wwww..ww..............
.......w...w...w.........w...wwwww.ww..............
.......ww.www.ww.........w...ww.wwwww..............
........w.w.w.w..........w...ww..wwww..............
........www.www..........w...ww...www..............
.........w...w...........w...ww....ww..............
.........w...w.....................................
...................................................
...................................................
...................................................
...................................................`
];

setMap(levels[level]);

onInput("s", () => {
  getFirst(player).y += 1
});

onInput("w", () => {
  getFirst(player).y -= 1
});

onInput("a", () => {
  getFirst(player).x -= 1
});

onInput("d", () => {
  getFirst(player).x += 1
});

afterInput(() => {
  const targetNumber = tilesWith(finnish).length;
  const numberCovered = tilesWith(finnish, player).length;
  if (numberCovered === targetNumber) {
     level = level + 1;
     setMap(levels[level]);
     if (levels[level] = 5) {
      setMap(levels[level]);
      } else {
      addText("you win!", { y: 4, color: [255, 0, 0] });
      }
  }
});
